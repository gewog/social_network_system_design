# Репликация и Шардирование в Социальной Сети

## Репликация
### Архитектура
- **Мастер (1) + Слейвы (2)**:
  - Мастер: обрабатывает все запросы на запись.
  - Слейвы: используются для распределения нагрузки на чтение.
  - Один из слейвов настроен как **hot standby** для автоматического фейловера.

- **Тип репликации**:
  - **Полусинхронная**: мастер ждёт подтверждения от хотя бы одного слейва перед завершением транзакции.
  - **Row-based**: репликация на уровне строк для минимизации объёма передаваемых данных.

- **Назначение**:
  - Пользователи пишут в мастер, читают из слейвов.

### Преимущества
- Высокая доступность.
- Распределение нагрузки на чтение.
- Быстрое восстановление после сбоев.

---

## Шардирование
### Архитектура
- **Key-based шардирование**:
  - Данные распределяются по шардам на основе уникального идентификатора пользователя (`user_id`).
  - Используется координатор для роутинга запросов.

- **Тип шардирования**:
  - **Key-based**: равномерное распределение данных.
  - **Роутинг**: координатор определяет, на каком шарде находятся данные.

### Преимущества
- Горизонтальное масштабирование.
- Упрощение управления большими объёмами данных.
- Возможность динамического добавления новых шардов.

---

## Партиционирование (горизонтальное)
- **По времени**: для таблиц с постами и сообщениями (например, `Posts`, `Messages`).
- **По хэшу**: для таблиц с равномерным доступом (например, `Users`).

---

## Схема Архитектуры
```plaintext
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Client    │    │   Client    │    │   Client    │
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │
       ▼                   ▼                   ▼
┌───────────────────────────────────────────────────┐
│                Load Balancer (NGINX)              │
└───────────────────────────────────────────────────┘
       │                   │                   │
       ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Master     │    │  Slave 1    │    │  Slave 2    │
│ (Write)     │    │ (Read)      │    │ (Hot Standby)│
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │
       ▼                   ▼                   ▼
┌───────────────────────────────────────────────────┐
│            Coordinator (Shard Router)             │
└───────────────────────────────────────────────────┘
       │                   │                   │
       ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  Shard 1    │    │  Shard 2    │    │  Shard N    │
└─────────────┘    └─────────────┘    └─────────────┘
